<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples · StateSpaceModels.jl</title><meta name="title" content="Examples · StateSpaceModels.jl"/><meta property="og:title" content="Examples · StateSpaceModels.jl"/><meta property="twitter:title" content="Examples · StateSpaceModels.jl"/><meta name="description" content="Documentation for StateSpaceModels.jl."/><meta property="og:description" content="Documentation for StateSpaceModels.jl."/><meta property="twitter:description" content="Documentation for StateSpaceModels.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">StateSpaceModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../manual/">Manual</a></li><li class="is-active"><a class="tocitem" href>Examples</a><ul class="internal"><li><a class="tocitem" href="#Nile-river-annual-flow"><span>Nile river annual flow</span></a></li><li><a class="tocitem" href="#Airline-passengers"><span>Airline passengers</span></a></li><li><a class="tocitem" href="#Finland-road-traffic-fatalities"><span>Finland road traffic fatalities</span></a></li><li><a class="tocitem" href="#Vehicle-tracking"><span>Vehicle tracking</span></a></li><li><a class="tocitem" href="#Cross-validation-of-the-forecasts-of-a-model"><span>Cross validation of the forecasts of a model</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Examples</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/LAMPSPUC/StateSpaceModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/LAMPSPUC/StateSpaceModels.jl/blob/master/docs/src/examples.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><p>In this section we show examples of applications and use cases of the package.</p><h2 id="Nile-river-annual-flow"><a class="docs-heading-anchor" href="#Nile-river-annual-flow">Nile river annual flow</a><a id="Nile-river-annual-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Nile-river-annual-flow" title="Permalink"></a></h2><p>Here we will follow an example from Durbin &amp; Koopman&#39;s book. We will use the <a href="../manual/#StateSpaceModels.LocalLevel"><code>LocalLevel</code></a> model applied to the annual flow of the Nile river at the city of Aswan between 1871 and 1970.</p><p>First, we load the data:</p><pre><code class="language-julia hljs">using CSV, DataFrames
nile = CSV.File(StateSpaceModels.NILE) |&gt; DataFrame
plt = plot(nile.year, nile.flow, label = &quot;Nile river annual flow&quot;)</code></pre><img src="e1b264dc.svg" alt="Example block output"/><p>Next, we fit a <a href="../manual/#StateSpaceModels.LocalLevel"><code>LocalLevel</code></a> model:</p><pre><code class="language-julia hljs">model = LocalLevel(nile.flow)
fit!(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LocalLevel</code></pre><p>We can analyze the filtered estimates for the level of the annual flow:</p><pre><code class="language-julia hljs">filter_output = kalman_filter(model)
plot!(plt, nile.year, get_filtered_state(filter_output), label = &quot;Filtered level&quot;)</code></pre><img src="7a85beb7.svg" alt="Example block output"/><p>We can do the same for the smoothed estimates for the level of the annual flow:</p><pre><code class="language-julia hljs">smoother_output = kalman_smoother(model)
plot!(plt, nile.year, get_smoothed_state(smoother_output), label = &quot;Smoothed level&quot;)</code></pre><img src="0ce3e54e.svg" alt="Example block output"/><p>StateSpaceModels.jl can also be used to obtain forecasts. Here we forecast 10 steps ahead:</p><pre><code class="language-julia hljs">steps_ahead = 10
dates = collect(nile.year[end] + Year(1):Year(1):nile.year[end] + Year(10))
forec = forecast(model, 10)
expected_value = forecast_expected_value(forec)
plot!(plt, dates, expected_value, label = &quot;Forecast&quot;)</code></pre><img src="8e5f206f.svg" alt="Example block output"/><p>We can also simulate multiple scenarios for the forecasting horizon based on the estimated predictive distributions.</p><pre><code class="language-julia hljs">scenarios = simulate_scenarios(model, 10, 100)
plot!(plt, dates, scenarios[:, 1, :], label = &quot;&quot;, color = &quot;grey&quot;, width = 0.2)</code></pre><img src="4aa40bfd.svg" alt="Example block output"/><p>The package also handles missing values automatically. To that end, the package considers that any <code>NaN</code> entries in the observations are missing values.</p><pre><code class="language-julia hljs">nile.flow[[collect(21:40); collect(61:80)]] .= NaN
plt = plot(nile.year, nile.flow, label = &quot;Annual nile river flow&quot;)</code></pre><img src="067d1b4d.svg" alt="Example block output"/><p>Even though the series has several missing values, the same analysis is possible:</p><pre><code class="language-julia hljs">model = LocalLevel(nile.flow)
fit!(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LocalLevel</code></pre><p>And the exact same code can be used for filtering and smoothing:</p><pre><code class="language-julia hljs">filter_output = kalman_filter(model)
smoother_output = kalman_smoother(model)
plot!(plt, nile.year, get_filtered_state(filter_output), label = &quot;Filtered level&quot;)
plot!(plt, nile.year, get_smoothed_state(smoother_output), label = &quot;Smoothed level&quot;)</code></pre><img src="39346208.svg" alt="Example block output"/><h2 id="Airline-passengers"><a class="docs-heading-anchor" href="#Airline-passengers">Airline passengers</a><a id="Airline-passengers-1"></a><a class="docs-heading-anchor-permalink" href="#Airline-passengers" title="Permalink"></a></h2><p>We often write the model SARIMA model as an ARIMA <span>$(p,d,q) \times (P,D,Q,s)$</span>, where the lowercase letters indicate the specification for the non-seasonal component, and the uppercase letters indicate the specification for the seasonal component; <span>$s$</span> is the periodicity of the seasons (e.g. it is often 4 for quarterly data or 12 for monthly data). The data process can be written generically as</p><p class="math-container">\[\begin{equation}
    \phi_p (L) \tilde \phi_P (L^s) \Delta^d \Delta_s^D y_t = A(t) + \theta_q (L) \tilde \theta_Q (L^s) \epsilon_t
\end{equation}\]</p><p>where</p><ul><li><span>$\phi_p (L)$</span> is the non-seasonal autoregressive lag polynomial,</li><li><span>$\tilde \phi_P (L^s)$</span> is the seasonal autoregressive lag polynomial,</li><li><span>$\Delta^d \Delta_s^D y_t$</span> is the time series, differenced <span>$d$</span> times, and seasonally differenced <span>$D$</span> times.,</li><li><span>$A(t)$</span> is the trend polynomial (including the intercept),</li><li><span>$\theta_q (L)$</span> is the non-seasonal moving average lag polynomial,</li><li><span>$\tilde \theta_Q (L^s)$</span> is the seasonal moving average lag polynomial</li></ul><p>sometimes we rewrite this as:</p><p class="math-container">\[\begin{equation}
    \phi_p (L) \tilde \phi_P (L^s) y_t^* = A(t) + \theta_q (L) \tilde \theta_Q (L^s) \epsilon_t
\end{equation}\]</p><p>where <span>$y_t^* = \Delta^d \Delta_s^D y_t$</span>. This emphasizes that just as in the simple case, after we take differences (here both non-seasonal and seasonal) to make the data stationary, the resulting model is just an ARMA model.</p><p>As an example, consider the airline model ARIMA <span>$(0,1,1) \times (0,1,1,12)$</span>. The data process can be written in the form above as:,</p><p class="math-container">\[\begin{equation}
    \Delta \Delta_{12} y_t = (1 - \theta_1 L) (1 - \tilde \theta_1 L^{12}) \epsilon_t
\end{equation}\]</p><p>Here, we have:</p><ul><li><span>$\phi_p (L) = 1$</span>, (i.e. there is no auto regressive effect)</li><li><span>$\tilde \phi_P (L^s) = 1$</span>, (i.e. there is no seasonal auto regressive effect)</li><li><span>$d = 1, D = 1, s=12$</span> indicating that <span>$y_t^*$</span> is derived from <span>$y_t$</span> by taking first-differences and then taking 12-th differences.,</li><li><span>$A(t) = 0$</span> no trend,</li><li><span>$\theta_q (L) = (1 - \theta_1 L)$</span>,</li><li><span>$\tilde \theta_Q (L^s) = (1 - \tilde \theta_1 L^{12})$</span>,</li></ul><p>It may still be confusing to see the two lag polynomials in front of the error variable, but notice that we can multiply the lag polynomials together to get the following model:</p><p class="math-container">\[\begin{equation}
    y_t^* = (1 - \theta_1 L - \tilde \theta_1 L^{12} + \theta_1 \tilde \theta_1 L^{13}) \epsilon_t
\end{equation}\]</p><p>For the airline model ARIMA <span>$(0,1,1) \times (0,1,1,12)$</span> with an intercept, the command is:</p><pre><code class="language-julia hljs">using CSV, DataFrames
air_passengers = CSV.File(StateSpaceModels.AIR_PASSENGERS) |&gt; DataFrame
log_air_passengers = log.(air_passengers.passengers)
model = SARIMA(log_air_passengers; order = (0, 1, 1), seasonal_order = (0, 1, 1, 12))
fit!(model)
print_results(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">                             Results
===============================================================
Model:                        SARIMA(0, 1, 1)x(0, 1, 1, 12) with zero mean
Number of observations:       144
Number of unknown parameters: 3
Log-likelihood:               244.6965
AIC:                          -483.3930
AICc:                         -483.2215
BIC:                          -474.4835
---------------------------------------------------------------
Parameter      Estimate      Std.Error      z stat      p-value
ma_L1           -0.4017         0.1193     -3.3677       0.0000
s_ma_L12        -0.5570         0.1424     -3.9116       0.0000
sigma2_η         0.0013         0.0024      0.5607       0.0000</code></pre><p>To make a forecast of 24 steps ahead of the model the command is:</p><pre><code class="language-julia hljs">forec = forecast(model, 24)
plot(model, forec; legend = :topleft)</code></pre><img src="9717b90f.svg" alt="Example block output"/><blockquote><p>The text from this example is based on Python`s <a href="https://www.statsmodels.org/stable/examples/notebooks/generated/statespace_sarimax_stata.html">statsmodels</a> library. The estimates for this example match up to the 3th decimal place the results of the paper <a href="https://www.jstatsoft.org/article/view/v041i03">State Space Methods in Ox/SsfPack</a> from the journal of statistical software.</p></blockquote><h2 id="Finland-road-traffic-fatalities"><a class="docs-heading-anchor" href="#Finland-road-traffic-fatalities">Finland road traffic fatalities</a><a id="Finland-road-traffic-fatalities-1"></a><a class="docs-heading-anchor-permalink" href="#Finland-road-traffic-fatalities" title="Permalink"></a></h2><p>In this example, we will follow what is illustrated on Commandeur, Jacques J.F. &amp; Koopman,  Siem Jan, 2007. &quot;An Introduction to State Space Time Series Analysis,&quot; OUP Catalogue,  Oxford University Press (Chapter 3). We will study the <a href="../manual/#StateSpaceModels.LocalLinearTrend"><code>LocalLinearTrend</code></a> model with  a series of the log of road traffic fatalities in Finalnd and analyse its slope to tell if the trend of fatalities was increasing or decrasing during different periods of time.</p><pre><code class="language-julia hljs">using StateSpaceModels, Plots, CSV, DataFrames
df = CSV.File(StateSpaceModels.VEHICLE_FATALITIES) |&gt; DataFrame
log_ff = log.(df.ff)
plt = plot(df.date, log_ff, label = &quot;Log of Finland road traffic fatalities&quot;)</code></pre><img src="0984f833.svg" alt="Example block output"/><p>We fit a <a href="../manual/#StateSpaceModels.LocalLinearTrend"><code>LocalLinearTrend</code></a></p><pre><code class="language-julia hljs">model = LocalLinearTrend(log_ff)
fit!(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LocalLinearTrend</code></pre><p>By extracting the smoothed slope we conclude that according to our model the trend of fatalities  in Finland was increasing in the years 1970, 1982, 1984 through to 1988, and in 1998</p><pre><code class="language-julia hljs">smoother_output = kalman_smoother(model)
plot(df.date, get_smoothed_state(smoother_output)[:, 2], label = &quot;slope&quot;)</code></pre><img src="057a6ef0.svg" alt="Example block output"/><h2 id="Vehicle-tracking"><a class="docs-heading-anchor" href="#Vehicle-tracking">Vehicle tracking</a><a id="Vehicle-tracking-1"></a><a class="docs-heading-anchor-permalink" href="#Vehicle-tracking" title="Permalink"></a></h2><p>This example illustrates how to perform vehicle tracking from noisy data.</p><pre><code class="language-julia hljs">using Random
Random.seed!(1)

# Define a random trajectory
n = 100
H = [1 0; 0 1.0]
Q = [1 0; 0 1.0]
rho = 0.1
model = VehicleTracking(rand(n, 2), rho, H, Q)
initial_state = [0.0, 0, 0, 0]
sim = StateSpaceModels.simulate(model.system, initial_state, n)

# Use a Kalman filter to get the predictive and filtered states
model = VehicleTracking(sim, 0.1, H, Q)
kalman_filter(model)
pos_pred = get_predictive_state(model)
pos_filtered = get_filtered_state(model)

# Plot a gif illustrating the result
using Plots
anim = @animate for i in 1:n
    plot(sim[1:i, 1], sim[1:i, 2], label=&quot;Measured position&quot;, line=:scatter, lw=2, markeralpha=0.2, color=:black, title=&quot;Vehicle tracking&quot;)
    plot!(pos_pred[1:i+1, 1], pos_pred[1:i+1, 3], label = &quot;Predicted position&quot;, lw=2, color=:forestgreen)
    plot!(pos_filtered[1:i, 1], pos_filtered[1:i, 3], label = &quot;Filtered position&quot;, lw=2, color=:indianred)
end
gif(anim, &quot;anim_fps15.gif&quot;, fps = 15)</code></pre><img src="e8a05a9f.gif" alt="Example block output"/><h2 id="Cross-validation-of-the-forecasts-of-a-model"><a class="docs-heading-anchor" href="#Cross-validation-of-the-forecasts-of-a-model">Cross validation of the forecasts of a model</a><a id="Cross-validation-of-the-forecasts-of-a-model-1"></a><a class="docs-heading-anchor-permalink" href="#Cross-validation-of-the-forecasts-of-a-model" title="Permalink"></a></h2><p>Often times users would like to compare the forecasting skill of different models. The function  <a href="../manual/#StateSpaceModels.cross_validation"><code>cross_validation</code></a> makes it easy to make a rolling window scheme of estimations and forecasts  that allow users to track each model forecasting skill per lead time. A simple plot recipe is implemented to help users to interpret the results easily.</p><pre><code class="language-julia hljs">using CSV, DataFrames
air_passengers = CSV.File(StateSpaceModels.AIR_PASSENGERS) |&gt; DataFrame
log_air_passengers = log.(air_passengers.passengers)
model = BasicStructural(log_air_passengers, 12)
b = cross_validation(model, 24, 50)
plot(b, &quot;Basic structural model&quot;)</code></pre><img src="7ed58058.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../manual/">« Manual</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Monday 17 March 2025 20:53">Monday 17 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
